<div class="wiki-wrapper">
    <aside class="wiki-sidebar">
        <div class="search-box-wiki">
            <input type="text" id="wiki-search" placeholder="Search..." onkeyup="filterMenu()">
            <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div id="nav-list">
             {% if page.url contains 'cubeui' %}
                {% else %}
                {% endif %}
        </div>
    </aside>

    <main class="wiki-content">
        <button id="sidebar-toggle" class="btn" style="display:none; margin-bottom:20px; width:auto;">
            <i class="fa-solid fa-bars"></i> Menu
        </button>
        
        <div class="wiki-article-header">
            <h1>{{ page.title }}</h1>
            </div>

        <div class="wiki-inner">
            {{ content }}
        </div>

        <footer class="wiki-footer">
            <div style="margin-top:40px; padding-top:20px; border-top:1px solid var(--border); color:var(--text-muted); font-size:0.9rem;">
                Last updated: {{ page.date | date: "%d.%m.%Y" }} • <a href="https://github.com/Denmoth/Denmoth.github.io/edit/main/{{ page.path }}">Edit this page</a>
            </div>
        </footer>
    </main>

    <aside class="wiki-toc">
        <div class="toc-sticky">
            <div class="toc-header">ON THIS PAGE</div>
            <ul id="toc-list"></ul>
        </div>
    </aside>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const tocList = document.getElementById('toc-list');
        const headers = document.querySelectorAll('.wiki-inner h2, .wiki-inner h3');
        
        headers.forEach(header => {
            if(!header.id) header.id = header.innerText.toLowerCase().replace(/[^a-z0-9]+/g, '-');
            
            const li = document.createElement('li');
            li.className = header.tagName.toLowerCase();
            
            const a = document.createElement('a');
            a.href = '#' + header.id;
            a.innerText = header.innerText;
            
            li.appendChild(a);
            tocList.appendChild(li);
        });

        // ScrollSpy (подсветка активного пункта)
        window.addEventListener('scroll', () => {
            let current = '';
            headers.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });
            
            document.querySelectorAll('#toc-list a').forEach(a => {
                a.classList.remove('active');
                if (a.getAttribute('href').includes(current)) {
                    a.classList.add('active');
                }
            });
        });
    });
</script>
